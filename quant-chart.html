<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>页面行情(K线图)</title>
  <!-- 加载资源 -->
  <link rel="stylesheet" href="css/tools.css" />
  <link rel="stylesheet" href="css/main.css" />
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1456981_b3y2pzilcnk.css" />
</head>

<body>
  <script type="text/javascript" src="https://at.alicdn.com/t/font_1456981_ohmhyy9wd9l.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/quantchart.js"></script>
  <script src="datas/datas.js"></script>
  <script src="utils/indicatorFormula.js"></script>
  <script src="indicators/baseFunc.js"></script>
  <script src="indicators/topLow.js"></script>
  <script src="datas/topLowDatas.js"></script>

  <div id="kline" style="width: 900px;height:400px;position: relative;"></div>
  <script>
    function KLineChart(divKLine) {
      var MACD = hxc3.IndicatorFormula.getClass('macd');
      var macdIndicator = new MACD();
      var macdDatas = macdIndicator.calculate(kLines);

      var RSI = hxc3.IndicatorFormula.getClass('rsi');
      var rsiIndicator = new RSI();
      var rsiDatas = rsiIndicator.calculate(kLines);

      var ASI = hxc3.IndicatorFormula.getClass('asi');
      var asiIndicator = new ASI();
      var asiDatas = asiIndicator.calculate(kLines);

      var KDJ = hxc3.IndicatorFormula.getClass('kdj');
      var kdjIndicator = new KDJ();
      var kdjDatas = kdjIndicator.calculate(kLines);

      console.log('kdj:', macdDatas)
      this.DivKLine = divKLine;
      this.Chart = QTChart.Init(divKLine);   //把K线图绑定到一个Div上
      this.Option = {
        chartArray: [
          {
            name: 'kline',
            goodsName: 'BTC/USDT',
            index: 0,
            datas: kLines,
            topLowDatas: topLowDatas,
          },
          {
            name: 'vol',
            index: 1,
            datas: kLines,
          },
          {
            name: 'macd',
            index: 2,
            datas: macdDatas,
            style: {
              DIFF: '#fa5252',
              DEA: '#5f5fff',
              MACD: '#fa5252'
            }
          },
          {
            name: 'rsi',
            index: 3,
            datas: rsiDatas,
            style: {
              RSI6: '#f71c17',
              RSI12: '#0680e0',
              RSI24: '#04477b'
            }
          },
          {
            name: 'asi',
            index: 4,
            datas: asiDatas,
            style: {
              ASI: '#f71c17',
              ASIT: '#0680e0',
            }
          },
          {
            name: 'kdj',
            index: 5,
            datas: kdjDatas,
            style: {
              K: '#f71c17',
              D: '#0680e0',
              J: '#ffc400'
            }
          }
        ]
      }

      this.Create = function () {
        var self = this;
        $(window).resize(function () { self.OnSize(); self.Chart.SetOnSizeChange(); });    //绑定窗口大小变化事件
        this.OnSize();  //让K线全屏
        this.Chart.SetOption(this.Option);//设置K线配置
      }

      this.OnSize = function ()  //自适应大小调整
      {
        var height = $(window).height();
        var width = $(window).width();
        this.DivKLine.style.top = 'px';
        this.DivKLine.style.left = 'px';
        this.DivKLine.style.width = width + 'px';
        this.DivKLine.style.height = height + 'px';
        this.Chart.OnSize();
      }
    }

    // jq函数，当文档载入后执行
    $(function () {
      var klineControl = new KLineChart(document.getElementById('kline'));
      klineControl.Create();
    })
  </script>
</body>

</html>